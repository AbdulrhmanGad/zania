<odoo>
    <data>

        <record id="breakdown_view_tree" model="ir.ui.view">
            <field name="name">breakdown_view_tree</field>
            <field name="model">break.down</field>
            <field name="arch" type="xml">
                <tree string="breakdown_tree">
                    <field name="project_id"/>
                    <field name="tender_line_id"/>
                    <field name="code"/>
                    <field name="name"/>
                    <field name="item_id"/>
                    <field name="uom_id"/>
                    <field name="qty"/>
                    <field name="type"/>
                    <field name="sale_price_amount"  sum="Total"/>
                    <field name="sale_price_amount_all" sum="Total"/>
                    <field name="state"/>
                    <field name="note"/>
                </tree>
            </field>
        </record>
        <record id="breakdown_view_form" model="ir.ui.view">
            <field name="name">breakdown_view_form</field>
            <field name="model">break.down</field>
            <field name="arch" type="xml">
                <form string="breakdown_form">
                    <header>
                        <button name="action_confirm" string="Confirm" class="oe_highlight" type="object"
                                states="draft"/>
                        <button name="action_approve" string="Approve" class="oe_highlight" type="object"
                                states="confirm"/>
                        <button name="action_financial" string="Create Financial" class="oe_highlight" type="object"
                                states="approve"/>
                        <field name="state" widget="statusbar" readonly="1"/>
                    </header>
                    <sheet>
                        <h1 class="oe_title">
                            <field name="name"/>
                        </h1>
                        <group>
                            <group>
                                <field name="customer_id"/>
                                <field name="project_id"/>
                                <field name="tender_line_id" domain="[('construction_id', '=', project_id)]"/>
                                <field name="code"/>
                                <field name="description"/>
                                <field name="qty"/>
                                <field name="item_id"/>
                                <field name="uom_id"/>
                                <field name="analytic_account_id"/>
                            </group>
                            <group>
                                <field name="type"/>
                                <field name="note"/>
                                <field name="start_date"/>
                                <field name="end_date"/>
                                <field name="differance"/>
                            </group>
                        </group>
                        <notebook>
                            <page name="material" string="Material">
                                <field name="material_ids"
                                       context="{'default_analytic_account_id':analytic_account_id,'default_type':'material' }">
                                    <tree editable="bottom">
                                        <field name="analytic_account_id" invisible="1"/>
                                        <field name="type" invisible="1"/>
                                        <field name="break_down_id" invisible="1"/>
                                        <field name="product_id"/>
                                        <field name="description"/>
                                        <field name="uom_id" required="1"/>
                                        <field name="qty" required="1"/>
                                        <field name="waste" required="1"/>
                                        <field name="planed_qty"/>
                                        <field name="cost_per_unit" required="1" sum="total"/>
                                        <field name="price_cost_subtotal" sum="total"/>
                                        <field name="total_qty"/>
                                        <field name="total_value" sum="total"/>
                                    </tree>
                                </field>
                            </page>
                            <page name="labour" string="Labour">
                                <field name="labour_ids"
                                       context="{'default_analytic_account_id':analytic_account_id,'default_type':'labour' }">
                                    <tree editable="bottom">
                                        <field name="analytic_account_id" invisible="1"/>
                                        <field name="type" invisible="1"/>
                                        <field name="break_down_id" invisible="1"/>
                                        <field name="product_id" domain="[('type', 'in', ['consu', 'service'])]"/>
                                        <field name="description"/>
                                        <field name="uom_id" required="1"/>
                                        <field name="planed_qty" readonly="True"/>
                                        <field name="cost_per_unit" required="1"/>
                                        <field name="price_cost_subtotal"/>
                                        <field name="total_qty"/>
                                        <field name="total_value"/>
                                    </tree>
                                </field>
                            </page>
                            <page name="expenses" string="Expenses">
                                <field name="expenses_ids"
                                       context="{'default_analytic_account_id':analytic_account_id,'default_type':'expenses' }">
                                    <tree editable="bottom">
                                        <field name="analytic_account_id" invisible="1"/>
                                        <field name="type" invisible="1"/>
                                        <field name="break_down_id" invisible="1"/>
                                        <field name="product_id" domain="[('type', 'in', ['consu', 'service'])]"/>
                                        <field name="description"/>
                                        <field name="uom_id" required="1"/>
                                        <field name="planed_qty" readonly="True"/>
                                        <field name="cost_per_unit" required="1"/>
                                        <field name="price_cost_subtotal"/>
                                        <field name="total_qty"/>
                                        <field name="total_value"/>
                                    </tree>
                                </field>
                            </page>
                            <page name="sub_contractor" string="Sub Contractor">
                                <field name="sub_contractor_ids"
                                       context="{'default_analytic_account_id':analytic_account_id,'default_type':'sub_contractor' }">
                                    <tree editable="bottom">
                                        <field name="analytic_account_id" invisible="1"/>
                                        <field name="type" invisible="1"/>
                                        <field name="break_down_id" invisible="1"/>
                                        <field name="product_id" domain="[('type', 'in', ['consu', 'service'])]"/>
                                        <field name="description"/>
                                        <field name="uom_id" required="1"/>
                                        <field name="planed_qty" readonly="True"/>
                                        <field name="cost_per_unit" required="1"/>
                                        <field name="price_cost_subtotal"/>
                                        <field name="total_qty"/>
                                        <field name="total_value"/>
                                    </tree>
                                </field>
                            </page>
                            <page name="equipment" string="Equipments">
                                <field name="equipment_ids"
                                       context="{'default_analytic_account_id':analytic_account_id,'default_type':'equipment' }">
                                    <tree editable="bottom">
                                        <field name="analytic_account_id" invisible="1"/>
                                        <field name="type" invisible="1"/>
                                        <field name="break_down_id" invisible="1"/>
                                        <field name="product_id" domain="[('type', 'in', ['consu', 'service'])]"/>
                                        <field name="description"/>
                                        <field name="uom_id" required="1"/>
                                        <field name="planed_qty" readonly="True"/>
                                        <field name="cost_per_unit" required="1"/>
                                        <field name="price_cost_subtotal"/>
                                        <field name="total_qty"/>
                                        <field name="total_value"/>
                                    </tree>
                                </field>
                            </page>
                            <page name="estimation" string="Estimation">
                                <group>
                                    <group>
                                        <field name="cost_price_total_all"/>
                                    </group>
                                    <group></group>
                                    <group string="Indirect">
                                        <field name="indirect_type"/>
                                        <field name="indirect_amount" force_save="1"
                                               attrs="{'readonly': [('indirect_type', '=', 'percentage')]}"/> <!-- -->
                                        <field name="indirect_percentage" force_save="1"
                                               attrs="{'readonly': [('indirect_type', '!=', 'percentage')]}"/> <!-- -->
                                        <field name="indirect_value"/>
                                    </group>
                                    <group string="Profit">
                                        <field name="profit_type"/>
                                        <field name="profit_amount" force_save="1"
                                               attrs="{'readonly': [('profit_type', '=', 'percentage')]}"/> <!-- -->
                                        <field name="profit_percentage" force_save="1"
                                               attrs="{'readonly': [('profit_type', '!=', 'percentage')]}"/> <!-- -->
                                        <field name="profit_value"/>
                                    </group>
                                    <group string="Tax">
                                        <field name="tax"/>
                                        <field name="tax_amount"/>
                                    </group>
                                    <group></group>
                                    <group string="Sale">
                                        <field name="sale_price_amount"/>
                                        <field name="sale_price_amount_all"/>
                                    </group>
                                </group>
                            </page>
                        </notebook>
                        <group class="oe_subtotal_footer oe_right" string="Total Value">
                            <field name="total_value_material"/>
                            <field name="total_value_labour"/>
                            <field name="total_value_expenses"/>
                            <field name="total_value_subcontractor"/>
                            <field name="total_value_equipment"/>
                            <div class="oe_subtotal_footer_separator oe_inline o_td_label">
                                <label for="total_value_all"/>
                            </div>
                            <field name="total_value_all" nolabel="1" class="oe_subtotal_footer_separator"/>
                        </group>
                        <div class="oe_clear"/>
                        <group class="oe_subtotal_footer oe_right" string="Cost Per Unit">
                            <field name="price_subtotal_material"/>
                            <field name="price_subtotal_labour"/>
                            <field name="price_subtotal_expenses"/>
                            <field name="price_subtotal_subcontractor"/>
                            <field name="price_subtotal_equipment"/>
                            <div class="oe_subtotal_footer_separator oe_inline o_td_label">
                                <label for="cost_price_total_all"/>
                            </div>
                            <field name="cost_price_total_all" nolabel="1" class="oe_subtotal_footer_separator"/>
                        </group>
                        <div class="oe_clear"/>
                    </sheet>
                </form>
            </field>
        </record>

        <record id="breakdown_action" model="ir.actions.act_window">
            <field name="name">Construction BreakDown</field>
            <field name="type">ir.actions.act_window</field>
            <field name="res_model">break.down</field>
            <field name="view_mode">tree,form</field>
        </record>
        <menuitem id="breakdown_menu" name="Break Down" action="breakdown_action"/>
    </data>
</odoo>